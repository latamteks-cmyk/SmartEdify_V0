---
title: SmartEdify - Auth Token Lifecycle
---
stateDiagram-v2
    [*] --> Unauthenticated

    Unauthenticated --> Authenticated: Login 'password / oauth'
    state Authenticated {
        [*] --> AccessValid
        AccessValid --> AccessExpiring: T ~ 'exp - threshold'
        AccessExpiring --> AccessValid: Silent refresh success
        AccessExpiring --> AccessExpired: Not refreshed in time
        AccessExpired --> AccessValid: Refresh with valid refresh token
        AccessExpired --> Revoked: Refresh token revoked
    }

    Authenticated --> LoggedOut: User logout
    Authenticated --> Revoked: Admin/security revocation

    state Revoked {
        [*] --> RevokedAccess
        RevokedAccess --> [*]
    }

    LoggedOut --> Unauthenticated: Clear session

    Unauthenticated --> RateLimited: Excessive failed attempts
    RateLimited --> Unauthenticated: Cooldown elapsed

    note right of Authenticated: Access Token 'short TTL'\nRefresh Token 'long TTL'\nRotation on each refresh\nStore only refresh 'httpOnly cookie'

